/* ==========================================================================
   Prancha Web – CSS base consolidado (dropdown único desktop+mobile)
   ========================================================================== */

/* -----------------------------
   Design tokens (CSS variables)
   ----------------------------- */
:root {
  --bg:           #f7f7fb;
  --card:         #ffffff;
  --text:         #1f2937;
  /* ↑ contraste AA para textos “muted” */
  --muted:        #4b5563;
  /* ↑ contraste não-textual de bordas (1.4.11) */
  --border:       #d1d5db;

  --primary:      #2563eb;
  --primary-strong:#1d4ed8;

  --danger:       #dc2626;
  --danger-strong:#b91c1c;

  --ring:         #93c5fd;

  --btn-bg:       #ffffff;
  --btn-bg-hover: #f3f4f6;

  --radius:       12px;
  --shadow-sm:    0 1px 2px rgba(0,0,0,.06);
  --shadow-md:    0 6px 18px rgba(37, 99, 235, .12);
  --shadow-focus: 0 0 0 3px var(--ring);

  --pict-bg: transparent;
  --pict-outline: transparent;

  --link:         #2563eb;
  --link-hover:   #2563eb;
  --link-visited: #2563eb;

  --base-font-size: 16px;
}

body[data-theme="dark"] {
  --bg:           #0f172a;   /* slate-900 */
  --card:         #111827;   /* gray-900 */
  --text:         #e5e7eb;   /* gray-200 */
  --muted:        #9ca3af;   /* gray-400 */
  --border:       #374151;   /* gray-700 */

  --primary:      #60a5fa;   /* blue-400 */
  --primary-strong:#3b82f6;  /* blue-500 */

  --danger:       #f87171;   /* red-400 */
  --danger-strong:#ef4444;   /* red-500 */

  --ring:         rgba(96,165,250,.45);

  --btn-bg:       #111827;
  --btn-bg-hover: #1f2937;

  --pict-bg: #bdbdbd;
  --pict-outline: #f5f5f5;

  --pict-preview-bg: #bdbdbd;
  --pict-preview-outline: #f5f5f5;

  --link:         #8ab4f8;
  --link-hover:   #8ab4f8;
  --link-visited: #8ab4f8;
}

/* Reset leve */
* { box-sizing: border-box; }
html, body { height: 100%; }

html {
  font-size: var(--base-font-size, 16px);
}

body {
  margin: 0;
  font-family: system-ui, -apple-system, "Segoe UI", Roboto, Ubuntu, "Helvetica Neue", Arial, "Noto Sans", "Apple Color Emoji","Segoe UI Emoji", "Segoe UI Symbol", "Noto Color Emoji", sans-serif;
  background: var(--bg);
  color: var(--text);
  line-height: 1.5;
  transition: background .25s ease, color .25s ease;
}

/* Utilitários */
.sr-only { position:absolute; width:1px; height:1px; padding:0; margin:-1px; overflow:hidden; clip:rect(0,0,0,0); white-space:nowrap; border:0; }
.ml-8 { margin-left: 8px !important; }

/* --------------
   Layout geral
   -------------- */
.container {
  max-width: 1000px;
  margin: 0 auto;
  padding: 16px;
}

.logo {
  max-height: 60px;
  display: block;
  margin: 12px auto 8px;
  color:#4B5563;
}

.menu-superior {
  display: flex;
  align-items: center;
  justify-content: space-between;
  gap: 12px;
  flex-wrap: wrap;
}

.menu-superior nav {
  display: flex;
  gap: 8px;
  flex-wrap: wrap;
}

/* ===== Menu dropdown único (desktop + mobile) ===== */
.nav-wrap { display: flex; align-items: center; gap: 12px; }

.menu-drop { position: relative; display: block; z-index: 10; }
.menu-drop > summary.botao-acao { list-style: none; position: relative; z-index: 1; }
.menu-drop > summary::-webkit-details-marker { display: none; }
.menu-drop > summary::marker { content: ''; }

/* Painel flutuante – sempre ancora no lado ESQUERDO do botão.
   Assim ele abre para a DIREITA e nunca sai da tela em monitores 1360px. */
.menu-drop__panel{
  position: absolute;
  top: calc(100% + 8px);
  left: 0;                 /* <- chave do ajuste */
  right: auto;
  min-width: 240px;
  width: auto;
  max-width: min(360px, calc(100vw - 24px)); /* garante que não passe da viewport */
  display: flex;
  flex-direction: column;
  gap: 8px;
  padding: 10px;
  border-radius: var(--radius);
  border: 1px solid var(--border);
  background: var(--card);
  box-shadow: var(--shadow-md);
  opacity: 0;
  transform: translateY(-4px) scale(0.98);
  pointer-events: none;
  transition: opacity .16s ease, transform .16s ease;
  z-index: 2;
  max-height: min(70vh, 480px);   /* evita corte vertical; ativa rolagem */
  overflow-y: auto;
}
@supports (height: 100dvh){
  .menu-drop__panel{ max-height: min(70dvh, 480px); }
}

/* abre com animação */
.menu-drop[open] .menu-drop__panel{
  opacity: 1;
  transform: translateY(0) scale(1);
  pointer-events: auto;
}

/* links do painel ocupam 100% e alinham à esquerda */
.menu-link{
  justify-content: flex-start;
  width: 100%;
}

/* Menu horizontal fica sempre oculto (usamos somente o dropdown) */
.menu-inline{ display: none !important; }

/* acessibilidade extra – foco já herda do tema/wcag */
.form-sair { margin-left: auto; }

hr {
  border: 0;
  border-top: 1px solid var(--border);
  margin: 16px 0;
}

/* -----------------------------------------
   Botões & ações – APLICAR EM TODO SISTEMA
   ----------------------------------------- */
:where(button,
       input[type="submit"],
       input[type="button"],
       .botao-acao,
       summary.botao-acao) {
  appearance: none;
  -webkit-appearance: none;
  background: var(--btn-bg);
  color: var(--text);
  border: 1px solid var(--border);
  border-radius: var(--radius);
  padding: .55rem .9rem;
  font: inherit;
  line-height: 1.1;
  display: inline-flex;
  align-items: center;
  justify-content: center;
  text-align: center;
  gap: .5rem;
  cursor: pointer;
  text-decoration: none;
  box-shadow: var(--shadow-sm);
  transition:
    background-color .18s ease,
    border-color .18s ease,
    color .18s ease,
    transform .06s ease,
    box-shadow .18s ease,
    filter .18s ease;
}

:where(button,
       input[type="submit"],
       input[type="button"],
       .botao-acao,
       summary.botao-acao):hover {
  background: var(--btn-bg-hover);
  border-color: var(--primary);
  box-shadow: var(--shadow-md);
  transform: translateY(-1px);
}

:where(button,
       input[type="submit"],
       input[type="button"],
       .botao-acao,
       summary.botao-acao):active {
  transform: translateY(0);
  filter: brightness(0.98);
}

:where(button,
       input[type="submit"],
       input[type="button"],
       .botao-acao,
       summary.botao-acao):focus-visible {
  outline: none;
  box-shadow: var(--shadow-md), var(--shadow-focus);
  border-color: var(--primary-strong);
}

:where(button,
       input[type="submit"],
       input[type="button"],
       .botao-acao,
       summary.botao-acao)[disabled],
:where(button,
       input[type="submit"],
       input[type="button"],
       .botao-acao,
       summary.botao-acao)[aria-disabled="true"] {
  opacity: .6;
  pointer-events: none;
}

/* Variante de perigo (excluir) */
:where(.botao-acao.excluir) {
  border-color: color-mix(in srgb, var(--danger) 50%, var(--border));
  color: var(--text);
}
:where(.botao-acao.excluir):hover {
  border-color: var(--danger-strong);
  box-shadow: 0 6px 18px rgba(220, 38, 38, .18);
}

/* Botão grande usado em “Falar tudo” */
.botao-falar-tudo { font-weight: 600; }

/* -----------------------
   Links de navegação
   ----------------------- */
a.botao-acao { color: inherit; }
a.botao-acao:visited { color: inherit; }

/* Links em conteúdo de texto (sem sublinhado) */
:where(main, .card, .container) a:not(.botao-acao){
  color: var(--link);
  text-decoration: none;              /* <<< sem sublinhado */
  font-weight: 600;                   /* pista visual extra (opcional) */
  border-bottom: 1px solid transparent;
  transition: color .15s ease, border-color .15s ease, background-color .15s ease;
}

/* hover “calmo” (linha fininha + leve mudança de cor) */
:where(main, .card, .container) a:not(.botao-acao):hover{
  color: var(--link-hover);
  border-bottom-color: color-mix(in srgb, var(--link) 45%, transparent);
}

/* visited diferente do padrão (sem neon no escuro) */
:where(main, .card, .container) a:not(.botao-acao):visited{
  color: var(--link-visited);
}

/* foco acessível sem sublinhado */
:where(main, .card, .container) a:not(.botao-acao):focus-visible{
  outline: none;
  box-shadow: var(--shadow-focus);
  background: color-mix(in srgb, var(--link) 14%, transparent);
  border-radius: 6px;
  padding-inline: 2px;  /* evita “pulo” visual do realce */
  margin-inline: -2px;
}

/* -----------------------
   Campos de formulário
   ----------------------- */
input[type="text"],
input[type="email"],
input[type="password"],
input[type="number"],
textarea,
select {
  width: 100%;
  max-width: 520px;
  padding: .55rem .7rem;
  border: 1px solid var(--border);
  border-radius: var(--radius);
  background: var(--card);
  color: var(--text);
  outline: none;
  transition: border-color .18s ease, box-shadow .18s ease, background-color .18s ease, color .18s ease;
}

input[type="text"]:hover,
input[type="email"]:hover,
input[type="password"]:hover,
input[type="number"]:hover,
textarea:hover,
select:hover {
  border-color: var(--primary);
  box-shadow: var(--shadow-sm);
  background: color-mix(in srgb, var(--card) 90%, var(--primary) 10%);
}

input[type="text"]:focus,
input[type="email"]:focus,
input[type="password"]:focus,
input[type="number"]:focus,
textarea:focus,
select:focus {
  border-color: var(--primary-strong);
  box-shadow: var(--shadow-focus);
}

/* Ajuda e pequenos textos */
.help { color: var(--muted); font-size: .925rem; margin-top: 4px; }

/* -----------------------
   Grades e seções
   ----------------------- */
.grid-2 {
  display: grid;
  grid-template-columns: repeat(2, minmax(0,1fr));
  gap: 20px;
}
@media (max-width: 860px) {
  .grid-2 { grid-template-columns: 1fr; }
}

/* -----------------------
   Alertas
   ----------------------- */
.alert {
  padding: 12px 14px;
  border-radius: var(--radius);
  background: var(--card);
  border: 1px solid var(--border);
  box-shadow: var(--shadow-sm);
}
.alert--success { border-color: #22c55e33; }
.alert--danger  { border-color: #ef444433; }

/* -----------------------
   Tabelas (lista de usuários)
   ----------------------- */
.table, .tabela {
  width: 100%;
  border-collapse: separate;
  border-spacing: 0;
  background: var(--card);
  border: 1px solid var(--border);
  border-radius: var(--radius);
  overflow: hidden;
  box-shadow: var(--shadow-sm);
}
.tabela thead th {
  text-align: left;
  padding: 10px 12px;
  border-bottom: 1px solid var(--border);
  background: var(--btn-bg-hover);
}
.tabela tbody td {
  padding: 10px 12px;
  border-bottom: 1px solid var(--border);
}
.tabela:not(.tabela--usuarios) col.id    { width: 64px; }
.tabela:not(.tabela--usuarios) col.nome  { width: 22%; }
.tabela:not(.tabela--usuarios) col.email { width: 28%; }
.tabela:not(.tabela--usuarios) col.tipo  { width: 110px; }
.tabela:not(.tabela--usuarios) col.tema  { width: 120px; }
.tabela:not(.tabela--usuarios) col.acoes { width: 220px; }
.tabela:not(.tabela--usuarios) col.bateria { width: 110px; }
.tabela tbody tr:last-child td { border-bottom: 0; }
.celula-acao, .celula-salvar { white-space: nowrap; }

/* <details> usado nas ações da tabela */
details > summary.botao-acao{ 
  list-style: none;
  display: inline-flex;
  align-items: center;
  justify-content: center;
}
details > summary.botao-acao::-webkit-details-marker{ display:none; }
details > summary.botao-acao::marker{ content:''; }

/* -----------------------
   Lista de cartões
   ----------------------- */
.lista-cartoes {
  display: grid;
  grid-template-columns: repeat(auto-fill, minmax(160px, 1fr));
  gap: 16px;
}
.cartao-item {
  background: var(--card);
  border: 1px solid var(--border);
  border-radius: var(--radius);
  padding: 10px;
  text-align: center;
  box-shadow: var(--shadow-sm);
  transition: transform .12s ease, box-shadow .18s ease, border-color .18s ease;
  cursor: pointer;
  position: relative;
}
.cartao-item:hover {
  transform: translateY(-2px);
  border-color: var(--primary);
  box-shadow: var(--shadow-md);
}
.cartao-item img {
  max-width: 100%;
  max-height: 120px;
  object-fit: contain;
  border-radius: 8px;
  background: var(--pict-bg);
  box-shadow: inset 0 0 0 1px var(--pict-outline);
  transition: background-color .2s ease, box-shadow .2s ease;
}

.cartao-item.is-selected { border-color: var(--primary); box-shadow: var(--shadow-md); }

.cartao-item .ordem-badge {
  position: absolute;
  top: 8px;
  right: 8px;
  width: 28px;
  height: 28px;
  border-radius: 50%;
  display: none;              /* o JS liga com inline-flex quando selecionado */
  background: var(--primary);
  color: #fff;
  font-weight: 800;
  font-size: .9rem;
  line-height: 1;
  text-align: center;
  align-items: center;
  justify-content: center;
  box-shadow: var(--shadow-sm);
  z-index: 1;
  pointer-events: none;
}

/* -----------------------
   Login
   ----------------------- */
.login-container {
  max-width: 360px;
  margin: 8vh auto 0;
  background: var(--card);
  border: 1px solid var(--border);
  border-radius: var(--radius);
  padding: 20px;
  text-align: center;
  box-shadow: var(--shadow-sm);
}

/* -----------------------
   Acessórios
   ----------------------- */
fieldset {
  border: 1px solid var(--border);
  border-radius: var(--radius);
  padding: 10px 12px;
  background: var(--card);
}
legend { padding: 0 6px; color: var(--muted); }

label { display: inline-block; margin-bottom: 4px; color: var(--text); }
.campo { margin: 10px 0; }

/* =========================
   VARIANTE "EXCLUIR" (vermelho)
   ========================= */
body[data-theme="light"] {
  --danger-bg: #c62828;
  --danger-bg-hover: #c62828;
  --danger-border: #b71c1c;
  --danger-text: #ffffff;
  --danger-focus: rgba(229,57,53,.40);
}
body[data-theme="dark"] {
  --danger-bg: #d32f2f;
  --danger-bg-hover: #b71c1c;
  --danger-border: #ef5350;
  --danger-text: #ffffff;
  --danger-focus: rgba(239,83,80,.35);
}
body[data-theme="dark"] .logo { color:#E5E7EB }

.botao-acao.excluir {
  background: var(--danger-bg);
  border-color: var(--danger-border);
  color: var(--danger-text);
}
.botao-acao.excluir:hover,
.botao-acao.excluir:focus-visible {
  background: var(--danger-bg-hover);
  border-color: var(--danger-border);
  color: var(--danger-text);
}
.botao-acao.excluir:focus-visible {
  outline: none;
  box-shadow: 0 0 0 3px var(--danger-focus);
}
.botao-acao.excluir[disabled],
.botao-acao.excluir[aria-disabled="true"] {
  opacity: .55;
  cursor: not-allowed;
  filter: saturate(.85);
}
a.botao-acao.excluir:link,
a.botao-acao.excluir:visited {
  color: var(--danger-text);
}

.campo[aria-label="Pré-visualização da imagem atual"] img {
  background: var(--pict-preview-bg);
  padding: 8px;
  border-radius: 12px;
  box-shadow: inset 0 0 0 1px var(--pict-preview-outline);
  display: inline-block;
}

/* ====== Criar Cartão – ARASAAC (input + select + botão) ====== */
#arasaac-box > div:first-of-type{
  gap: 8px;
  align-items: center;
}
#arasaac-q{
  flex: 1 1 420px;
  max-width: none;
  min-width: 200px;
}
#arasaac-lang{
  width: auto;
  max-width: none;
  flex: 0 0 auto;
  white-space: nowrap;
}
#arasaac-buscar{ flex: 0 0 auto; }
@supports (width: fit-content){
  #arasaac-lang{ width: fit-content; }
}
@media (max-width: 720px){
  #arasaac-box > div:first-of-type{
    flex-direction: column;
    align-items: stretch;
  }
  #arasaac-q,
  #arasaac-lang,
  #arasaac-buscar{
    width: 100%;
    max-width: none;
  }
}

/* ===== Respeita usuários com motion reduzido ===== */
@media (prefers-reduced-motion: reduce){
  * { transition: none !important; animation: none !important; }
  .botao-acao:hover { transform: none !important; }
}

/* =======================================================================
   GRUPOS EXPANDÍVEIS (chips → painel em largura total quando aberto)
   ======================================================================= */

.grupos-wrap{
  /* Mantemos como flex com quebra de linha: chips em linhas; painel ocupa uma linha inteira */
  display:flex;
  flex-wrap: wrap;
  gap: 12px;
  align-items: flex-start;
  margin: 10px 0 16px;
}

/* Cada grupo usa <details>. Ele será um flex item. */
.grupo-exp{
  position: relative;
  display: flex;            /* importante para colar chip + painel em coluna */
  flex-direction: column;
  flex: 0 0 auto;           /* chips ocupam só o necessário quando fechado */
  background: transparent;
  border: 0;
  padding: 0;
}

/* Quando o <details> está aberto, ele passa a ocupar 100% da largura da área de conteúdo */
.grupo-exp[open]{
  flex: 1 0 100%;           /* quebra a linha e usa toda a largura do container do site */
}

/* o chip é um botão visualmente consistente com .botao-acao */
.grupo-exp > summary.grupo-chip{
  list-style: none;
  -webkit-appearance: none;
  appearance: none;
  user-select: none;
  background: var(--btn-bg);
  color: var(--text);
  border: 1px solid var(--border);
  border-radius: 999px;
  padding: .65rem 1rem;
  min-height: 44px;            /* WCAG 2.5.5 */
  min-width: 44px;             /* WCAG 2.5.5 */
  display: inline-flex;        /* fica no tamanho do conteúdo, não estica */
  align-self: flex-start;      /* garante que o chip não ocupe largura total */
  align-items: center;
  gap: .5rem;
  cursor: pointer;
  box-shadow: var(--shadow-sm);
  transition: background .18s ease, border-color .18s ease, box-shadow .18s ease, transform .06s ease;
}
.grupo-exp > summary.grupo-chip::-webkit-details-marker{ display:none; }
.grupo-exp > summary.grupo-chip::marker{ content:''; }

.grupo-exp > summary.grupo-chip:hover{
  background: var(--btn-bg-hover);
  border-color: var(--primary);
  box-shadow: var(--shadow-md);
  transform: translateY(-1px);
}
.grupo-exp[open] > summary.grupo-chip{
  border-color: var(--primary-strong);
  box-shadow: var(--shadow-md), var(--shadow-focus);
}

/* contador discreto mas com contraste suficiente */
.grupo-chip__count{
  font-size: .9rem;
  color: var(--muted);
}

/* painel expandido ocupa 100% da largura útil do sistema (container pai) */
.grupo-exp__painel{
  position: relative;
  width: 100%;
  margin-top: 10px;
  border: 1px solid var(--border);
  border-radius: var(--radius);
  background: var(--card);
  padding: 14px;
  box-shadow: var(--shadow-sm);
}

/* barra de ações do grupo (só admins veem botões) */
.grupo-exp__acoes{
  display:flex;
  gap: 8px;
  flex-wrap: wrap;
  justify-content: flex-end;
  margin-bottom: 12px;
}

/* container de feedback quando não tem itens */
.grupo-exp__vazio{
  border: 1px dashed var(--border);
  border-radius: var(--radius);
  padding: 14px;
  text-align: center;
  color: var(--muted);
}

/* reduz efeitos se o usuário preferir menos movimento */
@media (prefers-reduced-motion: reduce){
  .grupo-exp > summary.grupo-chip:hover{ transform:none; }
}

/* ===== Dropdown de Ações (⋮) ===== */
.acoes-drop{
  position: relative;
  display:inline-block;
  /* elevamos o host do dropdown para ficar acima de chips/badges */
  z-index: 10010;
}
.acoes-drop > summary.botao-acao { list-style: none; }
.acoes-drop > summary::-webkit-details-marker{ display:none; }
.acoes-drop > summary::marker{ content:''; }

/* Painel do dropdown – fica acima de tudo */
.acoes-drop__panel{
  position: absolute;
  top: calc(100% + 8px);
  min-width: 200px;
  max-width: min(320px, calc(100vw - 24px));
  display: flex;
  flex-direction: column;
  gap: 8px;
  padding: 10px;
  border-radius: var(--radius);
  border: 1px solid var(--border);
  background: var(--card);
  box-shadow: var(--shadow-md);
  opacity: 0;
  transform: translateY(-4px) scale(.98);
  pointer-events: none;
  transition: opacity .16s ease, transform .16s ease;
  z-index: 10020;
  max-height: min(70vh, 360px);
  overflow-y: auto;
}

.container { position: relative; } /* referência para medição do espaço interno */

/* Padrão: ancora à DIREITA do botão e abre para a esquerda */
.acoes-drop { position: relative; }
.acoes-drop.align-right .acoes-drop__panel {
  right: 0;
  left: auto;
}

/* Alternativo: ancora à ESQUERDA do botão e abre para a direita */
.acoes-drop.align-left .acoes-drop__panel {
  left: 0;
  right: auto;
}

.acoes-drop[open] .acoes-drop__panel{
  opacity: 1;
  transform: translateY(0) scale(1);
  pointer-events: auto;
}

/* Quando o dropdown está aberto, o card/“cartão” sobe na pilha e não aplica transform */
.prancha-item.is-drop-open,
.cartao-item.is-drop-open{
  position: relative;
  z-index: 10005;             /* abaixo do painel, acima do resto */
  transform: none !important; /* evita criar stacking context concorrente */
}

/* Contêineres não podem cortar o dropdown */
.grupo-exp__painel,
.lista-pranchas,
.lista-cartoes,
.prancha-item,
.cartao-item{
  overflow: visible;
}
